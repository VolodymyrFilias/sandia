!function(){if(window.WebSocket){var t=null;window.__REPLAIN_&&(t=window.__REPLAIN_),window.replainSettings&&(t=window.replainSettings.id),null===t&&console.warn("Re:plain: Invalid widget code");var e=null;document.body?r():document.addEventListener("DOMContentLoaded",function(){r()})}function n(t){return JSON.stringify(t).replace(/,/g,";").replace(/"/g,"").slice(1,-1)}function i(){var t=window,e=document,n=e.documentElement,i=e.getElementsByTagName("body")[0];return{width:t.innerWidth||n.clientWidth||i.clientWidth,height:t.innerHeight||n.clientHeight||i.clientHeight}}function o(t,i,o,a){var r="100%"===i.height,d=navigator.userAgent.match(/(iPad|iPhone|iPod)/g);d&&r?(null===e&&(e=document.body.style.cssText),document.body.style.cssText=a):d&&!r&&null!==e&&(document.body.style.cssText=e),t.style.cssText=n(function(t,e){for(var n in e)t[n]=e[n];return t}(o,i))}function a(e){var o=document.createElement("div");o.id="__replain_widget",o.style.cssText=n(e),o.innerHTML='<iframe id="__replain_widget_iframe" src="https://widget.replain.cc/dist/index.html?1544493695735" scrolling="no" frameBorder="0" allowfullscreen="" style="display:block !important; visibility:visible !important; background:none transparent !important; opacity:1 !important; overflow:visible !important; position:absolute !important; left:0 !important; top:0 !important; width:100% !important; min-width:auto !important; max-width:100vw !important; height:100% !important; min-height:auto !important; max-height:100% !important; z-index:2147483647 !important; transition:none !important;"></iframe>',document.body.appendChild(o);var a=document.getElementById("__replain_widget_iframe");return a.onload=function(){a.contentWindow.postMessage(JSON.stringify({cmd:"init",data:{chatId:t,clientInfo:{language:document.getElementsByTagName("html")[0].getAttribute("lang"),windowSize:i(),currentUrl:location.href,auth:(localStorage.hasOwnProperty("REPLAIN_AUTH")?JSON.parse(localStorage.getItem("REPLAIN_AUTH")):JSON.parse(localStorage.getItem("REPLAIN_AUTH_"+t)))||{},cache:(localStorage.hasOwnProperty("REPLAIN_CACHE")?JSON.parse(localStorage.getItem("REPLAIN_CACHE")):JSON.parse(localStorage.getItem("REPLAIN_CACHE_"+t)))||{}}}}),"*")},o}function r(){var e={position:"fixed",top:"auto",left:"auto",bottom:"20px",right:"20px",width:"64px",height:"64px","z-index":"2147483647",transform:"translate3d(0, 0, 0)","-webkit-transform":"translate3d(0, 0, 0)","background-color":"transparent"},n=new function(){var t=this;this.defaultTitle=document.title,this.timerId=null;var e=function(n,i){i++,document.title=i%2?n:this.defaultTitle,t.timerId=setTimeout(e.bind(t,n,i),1e3)};this.show=function(t){null===this.timerId&&(e(t,0),document.addEventListener("visibilitychange",this.hide))},this.hide=function(){document.hidden||(document.title=t.defaultTitle,clearTimeout(t.timerId),t.timerId=null,document.removeEventListener("visibilitychange",t.hide))}},r=a(e);window.addEventListener("message",function(i){if(-1!==i.origin.indexOf("https://widget.replain.cc")){var a=JSON.parse(i.data);switch(a.cmd){case"storage-save":d=a.data.key,l=JSON.stringify(a.data.data),localStorage.setItem(d+"_"+t,l),localStorage.hasOwnProperty(d)&&localStorage.removeItem(d);break;case"widget-style":o(r,a.data,e,"position:fixed; left:0px; top:0px; width:100%; height:100%; margin: 0; padding: 0; overflow:hidden;");break;case"new-message":document.hidden&&n.show(a.data);break;case"log-event":!function(t,e){try{var n=window[window.GoogleAnalyticsObject||"ga"];"function"==typeof n&&("function"==typeof n.getAll?n.getAll()[0].send("event",t,e):n("send","event",t,e)),"object"==typeof _gaq&&"function"==typeof window._gaq.push&&window._gaq.push(["_trackEvent",t,e])}catch(t){console.warn("Replain: Error while trying to send event to Google Analytics:",t)}try{var i=window.Ya&&(window.Ya.Metrika||window.Ya.Metrika2);if("function"==typeof i&&"function"==typeof i.counters){var o=i.counters()[0].id;window["yaCounter"+o].reachGoal(t+"_"+e.replace(/\s/g,"_"))}}catch(t){console.warn("Replain: Error while trying to send event to Yandex.Metrika:",t)}}(a.data.category,a.data.action)}}var d,l});var d=document.getElementById("__replain_widget_iframe");window.addEventListener("resize",function(){d.contentWindow.postMessage(JSON.stringify({cmd:"resize",data:i()}),"*")}),window.addEventListener("visibilitychange",function(){d.contentWindow.postMessage(JSON.stringify({cmd:"visibilityChanged",data:document.hidden}),"*")}),window.ReplainAPI=function(t,e){d.contentWindow.postMessage(JSON.stringify({cmd:"api",data:{method:t,params:e}}),"*")}}}();